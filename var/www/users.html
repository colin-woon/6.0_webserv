<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>CGI User API</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			background-color: #121212;
			color: #e1e1e1;
			margin: 20px;
			max-width: 900px;
		}

		h1,
		h2 {
			color: #00bcd4;
			border-bottom: 2px solid #555;
			padding-bottom: 5px;
		}

		.container {
			display: flex;
			gap: 30px;
		}

		.form-card,
		.list-card {
			flex: 1;
			background: #1e1e1e;
			padding: 20px;
			border-radius: 8px;
		}

		input {
			width: 95%;
			padding: 8px;
			margin-bottom: 10px;
			border-radius: 4px;
			border: 1px solid #555;
			background: #333;
			color: #fff;
		}

		button {
			padding: 10px 15px;
			background: #00bcd4;
			color: #111;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-weight: bold;
		}

		button:hover {
			background: #0097a7;
		}

		ul {
			list-style: none;
			padding: 0;
		}

		li {
			background: #2a2a2a;
			padding: 10px;
			margin-bottom: 8px;
			border-radius: 4px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		pre {
			background: #222;
			padding: 15px;
			border-radius: 4px;
			border: 1px solid #444;
			overflow-x: auto;
		}
	</style>
</head>

<body>
	<h1>User API Frontend</h1>
	<div class="container">
		<div class="form-card">
			<h2>Create New User</h2>
			<form id="userForm">
				<label for="name">Name:</label>
				<input type="text" id="name" name="name" required>

				<label for="title">Title:</label>
				<input type="text" id="title" name="title" required>

				<button type="submit">Create User</button>
			</form>
		</div>

		<div class="list-card">
			<h2>User List</h2>
			<ul id="userList">
			</ul>
		</div>
	</div>

	<h2>API Output Log</h2>
	<pre id="output">Waiting for an API call...</pre>

	<script>
		// Get all the DOM elements we need
		const userForm = document.getElementById('userForm');
		const userList = document.getElementById('userList');
		const outputLog = document.getElementById('output');

		// --- Handle POST (Create User) ---
		userForm.addEventListener('submit', async (e) => {
			e.preventDefault(); // Stop the form from doing a traditional (non-JS) submit

			// This is the modern, correct way to get 'application/x-www-form-urlencoded' data
			const formData = new URLSearchParams(new FormData(userForm));
			outputLog.textContent = 'Sending POST request...';

			try {
				const response = await fetch('/cgi-bin/user.js', {
					method: 'POST',
					headers: {
						// This header MUST match what the backend expects!
						'Content-Type': 'application/x-www-form-urlencoded'
					},
					body: formData
				});

				const result = await response.json();
				outputLog.textContent = JSON.stringify(result, null, 2);

				if (response.ok) {
					addUserToList(result); // Add the new user to our list
					userForm.reset();
				}

			} catch (err) {
				outputLog.textContent = `Error: ${err.message}`;
			}
		});

		// --- Handle GET (Get User Details) ---
		async function getUserDetails(id) {
			outputLog.textContent = `Sending GET request for id=${id}...`;
			try {
				const response = await fetch(`/cgi-bin/user.js?id=${id}`);
				const result = await response.json();
				outputLog.textContent = JSON.stringify(result, null, 2);
			} catch (err) {
				outputLog.textContent = `Error: ${err.message}`;
			}
		}

		// --- Helper to update the UI ---
		function addUserToList(user) {
			const li = document.createElement('li');
			li.textContent = `${user.name} (${user.title})`;

			const getButton = document.createElement('button');
			getButton.textContent = 'Get Details';
			// This is the feedback loop!
			getButton.onclick = () => getUserDetails(user.id);

			li.appendChild(getButton);
			userList.appendChild(li);
		}

		// --- Initial Load ---
		// Let's pre-load the users that are already in the "database"
		document.addEventListener('DOMContentLoaded', () => {
			getUserDetails("1"); // Log user 1 to the output
			// Manually add the users we know are in the mock DB
			addUserToList({ id: "1", name: "Gigachad", title: "CEO" });
			addUserToList({ id: "2", name: "Colin", title: "Dev" });
		});
	</script>
</body>

</html>
